<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="travelMainDAO">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias alias="travelMain" type="geocni.travel.route.domain.TravelMain" />
    <typeAlias alias="travelRoute" type="geocni.travel.route.domain.TravelRoute" />
    <typeAlias alias="traveldestination" type="geocni.travel.route.domain.TravelDestination" />
    <typeAlias alias="travelRouteDaily" type="geocni.travel.route.domain.TravelRouteDaily" />
     
     
     
	<resultMap id="travelDestinationMin" class="geocni.travel.route.domain.TravelDestination">
		<result property="destId" column="dest_id" />
		<result property="destTitle" column="dest_title" />
		<result property="destAdSlogan" column="dest_ad_slogan" />
		<result property="destRegion" column="dest_region" />
		<result property="destCategory" column="dest_category" />
		<result property="destTag" column="dest_tag" />
		<result property="destWebsiteUrl" column="dest_website_url" />
		<result property="destImgPath" column="dest_img_path" />
		<result property="destPhone" column="dest_phone" />
		<result property="destAddress" column="dest_address" />
		<result property="destAxisX" column="dest_axis_x" />
		<result property="destAxisY" column="dest_axis_y" />
		<result property="destInformation" column="dest_information" />
		<result property="destSeason" column="dest_season" />
		<result property="destFeature" column="dest_feature" />
		<result property="destDescription" column="dest_description" />
		<result property="destRegDatetime" column="dest_reg_datetime" />
        <result property="travelFileList" column="dest_id" select="travelDestinationDAO.selectTravelFilesList" ></result>
	</resultMap>
     
     <resultMap id="travelDestinationMax" class="geocni.travel.route.domain.TravelDestination" extends="travelDestinationMin">
		<result property="destRecommPoint" column="dest_recomm_point" />
		<result property="destClipPoint" column="dest_clip_point" />
		<result property="destWriter" column="dest_writer" />
		<result property="destHit" column="dest_hit" />
	</resultMap>
	
	<sql id="travelMainDAO.checkWhereClause">
		<isNotEmpty property="destRegion" prepend="AND"> 
			<![CDATA[	dest_region = #destRegion#	]]>
		</isNotEmpty>
		<isNotEmpty property="destSeason" prepend="AND"> 
			<![CDATA[	dest_season = #destSeason#	]]>
		</isNotEmpty>
		<isNotEmpty property="destCategory" prepend="AND"> 
			<![CDATA[	dest_category = #destCategory#	]]>
		</isNotEmpty>
	</sql>
    
	<select id="travelMainDAO.selectBeachPerCnt" parameterClass="java.lang.String" resultClass="travelMain">
        <![CDATA[
			SELECT ETL_DT AS etlDt
			     , SEQ_ID AS seqId
			     , POI_NM AS poiNm
			     , UNIQ_POP AS uniqPop
			     , CONGESTION AS congestion
			  FROM GEO_BEACH_CONGESTION
             WHERE ETL_DT = (SELECT MAX(ETL_DT) FROM GEO_BEACH_CONGESTION where  ETL_DT like '2021%')
        ]]>
    </select>
    
    <select id="travelMainDAO.congestionExcel" parameterClass="java.lang.String" resultClass="travelMain">
        <![CDATA[
			SELECT ETL_DT AS etlDt
			     , SEQ_ID AS seqId
			     , POI_NM AS poiNm
			     , UNIQ_POP AS uniqPop
			     , CONGESTION AS congestion
			  FROM GEO_BEACH_CONGESTION
             WHERE ETL_DT = (SELECT MAX(ETL_DT) FROM GEO_BEACH_CONGESTION where  ETL_DT like '2021%1500')
             OR ETL_DT = (SELECT MAX(ETL_DT) FROM GEO_BEACH_CONGESTION where  ETL_DT like '2021%1600')
             OR ETL_DT = (SELECT MAX(ETL_DT) FROM GEO_BEACH_CONGESTION where  ETL_DT like '2021%1700')
        ]]>
    </select>
    
    <select id="travelMainDAO.congestionOverExcel" parameterClass="java.lang.String" resultClass="travelMain">
        <![CDATA[
			SELECT ETL_DT AS etlDt
			     , SEQ_ID AS seqId
			     , POI_NM AS poiNm
			     , UNIQ_POP AS uniqPop
			     , CONGESTION AS congestion 
			FROM GEO_BEACH_CONGESTION
			WHERE ETL_DT >= CONCAT(date_format(sysdate(), '%Y%m%d'),'0900')
			AND ETL_DT <= CONCAT(date_format(sysdate(), '%Y%m%d'),'1800')
			AND CONGESTION > 1
        ]]>
    </select>
   
    <select id="travelMainDAO.selectTravelMainDestination" parameterClass="travelMain" resultClass="egovMap">
        <![CDATA[
			SELECT
					a.etl_dt AS etlDt,
					a.poi_nm AS poiNm,
					a.uniq_pop AS uniqPop
			FROM geo_beach_congestion a
			JOIN geo_beach_congestion_destination b
			ON a.seq_id = b.seq_id 
			WHERE b.destId = #destId# AND 
			(a.etl_dt LIKE CONCAT ('%',#datestrtemp#,'%') or a.etl_dt LIKE CONCAT ('%',#datestrtemp2#,'%'));
        ]]>
    </select> 
    
     
     <select id="travelMainDAO.newselectBeachPerCnt" parameterClass="java.lang.String" resultClass="travelMain">
        <![CDATA[
			SELECT ETL_DT AS etlDt
			     , SEQ_ID AS seqId
			     , POI_NM AS poiNm
			     , UNIQ_POP AS uniqPop
			     , CONGESTION AS congestion
			  FROM GEO_BEACH_CONGESTION
             WHERE ETL_DT = #datestr#
        ]]>
    </select>
    
    <select id="travelMainDAO.selectBeachInfo" parameterClass="java.lang.String" resultClass="egovMap">
        <![CDATA[
			SELECT *
			  FROM GEO_BEACH_INFO
        ]]>
    </select>
    
    <select id="travelMainDAO.selectBeachDay" parameterClass="java.lang.String" resultClass="egovMap">
        <![CDATA[
			SELECT *
			  FROM GEO_BEACH_OPTIME
        ]]>
    </select>
    
        
    <select id="travelMainDAO.selectBeachPerCntapi" parameterClass="java.lang.String" resultClass="egovMap">
        <![CDATA[
			SELECT ETL_DT AS etlDt
			     , SEQ_ID AS seqId
			     , POI_NM AS poiNm
			     , UNIQ_POP AS uniqPop
			     , CONGESTION AS congestion
			  FROM GEO_BEACH_CONGESTION
             WHERE ETL_DT = (SELECT MAX(ETL_DT) FROM GEO_BEACH_CONGESTION where  ETL_DT like #date#)
        ]]>
    </select>
    
    <insert id="travelMainDAO.insertBeachPer">
		<![CDATA[
			INSERT INTO GEO_BEACH_CONGESTION ( 
					ETL_DT 
			     , SEQ_ID 
			     , POI_NM 
			     , UNIQ_POP 
			     , CONGESTION
			) VALUES ( 
				  #etlDt#
				, #seqId#
				, #poiNm#
				, #uniqPop#
				, #congestion#
			)
		]]>
	</insert>
	
	<select id="travelMainDAO.selectCongestion" parameterClass="java.lang.String" resultClass="egovMap">
        <![CDATA[
			SELECT *
			  FROM GEO_BEACH_INFO
        ]]>
    </select>
    
	<select id="travelMainDAO.selectBeachPerCntInsert" parameterClass="java.lang.String" resultClass="travelMain">
        <![CDATA[
			SELECT ETL_DT AS etlDt
			     , SEQ_ID AS seqId
			     , POI_NM AS poiNm
			     , UNIQ_POP AS uniqPop
			  FROM GEO_BEACH_CONGESTION
             WHERE ETL_DT = #datestr#
        ]]>
    </select>
    
     <select id="travelMainDAO.selectDataExistCnt" parameterClass="java.lang.String" resultClass="int">
        <![CDATA[
			SELECT count(*) AS cnt
			  FROM GEO_BEACH_CONGESTION
             WHERE ETL_DT = #datestr#
        ]]>
    </select>
    
    	<select id="travelMainDAO.selectTravelDestinationApi" parameterClass="traveldestination" resultClass="egovMap">
        <![CDATA[
			select 
				DEST_TITLE,
				DEST_AD_SLOGAN,
				DEST_REGION,
				DEST_CATEGORY,
				DEST_TAG,
				DEST_WEBSITE_URL,
				DEST_PHONE,
				DEST_ADDRESS,
				DEST_AXIS_X,
				DEST_AXIS_Y,
				DEST_FEATURE,
				DEST_INFORMATION,
				DEST_DESCRIPTION,
				DEST_WAY_TO_GO,
				DEST_SEASON
				 FROM geo_destination
             WHERE 1=1
        ]]>
         <include refid="travelMainDAO.checkWhereClause" />
    </select>
    
    	<select id="travelMainDAO.selectTravelrouteApi"  parameterClass="travelRoute" resultClass="travelRoute">
        <![CDATA[
			SELECT    a.rout_id AS routId
                , a.rout_title AS routTitle
                , a.rout_reg_member AS routRegMember
                , a.rout_region AS routRegion
                , a.rout_thumb_path AS routThumbPath
                , a.rout_memo AS routMemo
                , a.rout_hit AS routHit
                , a.rout_type AS routType
                , a.rout_open AS routOpen
                , a.rout_reg_date  AS routRegDate 
				, b.mbr_nm AS routRegMemberNm
			FROM geo_travel_route a
				LEFT JOIN jnitcmsmbr b ON a.rout_reg_member=b.mbr_id
			where 1=1
        ]]>
    </select>
    
    	<select id="travelMainDAO.selectTravelrouteDailyApi" parameterClass="travelRouteDaily" resultClass="travelRouteDaily">
        <![CDATA[
			  SELECT
                  rout_id AS routId
                , rout_days AS routDays
                , rout_start_point AS routStartPoint
                , rout_start_axis AS routStartAxis
                , rout_dest_point AS routDestPoint
                , rout_dest_axis AS routDestAxis
                , rout_way_point AS routWayPoint
            FROM geo_travel_route_daily
             WHERE 1=1
        ]]>
    </select>
	

    
    
</sqlMap>
